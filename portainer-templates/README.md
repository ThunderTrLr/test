# Portainer Templates

This repository contains a collection of templates for use with [Portainer](https://www.portainer.io/). These templates are automatically generated using a Python script that parses information from Docker Compose YAML files.

## Usage Precompiled Templates

##### Setup Portainer configuration:  
- Portainer -> Settings -> General -> App Templates -> URL:
- `https://raw.githubusercontent.com/yvvidolov/home-lab/main/portainer-templates/templates.json`

> The stacks in Portainer will reference this repository for the docker-compose.yml and environment files.

##### Deploy services using:
- Portainer -> Templates -> Application -> [choose stack from list]  
- read the instructions carefully
- configure settings  
- click `Deploy the stack`

##### Alternative template repo:

Biggest precompiled template list: https://github.com/Lissy93/portainer-templates  
`https://raw.githubusercontent.com/Lissy93/portainer-templates/main/templates.json`

# Tools

## Template Generator

- fork this repo
- add to `./docker-compose` new directories with services you wish to include
- from repository root execute: `python portainer-templates/tools/gen_all.py`
- autogenerated file `portainer-templates/templates.json` can be used directly in portainer
- publish templates and compose files
  - push changes to github and reference the repository
  - self host the files: `portainer-templates/tools/run_local_web_server.sh` # needs docker, follow cli instructions
    - `http://{IP}:8080/portainer-templates/templates_merge.json`

#### gen_all.py

Script will generate template metadata from the following files in each docker-compose subdirectory:
- `README.md`: this will be included as `note` when you select the template in portainer
  - this will overwrite #info tag in docker-compose.yml
- `.env`: settings, default values and descriptions will be added for each variable
  - var_name=var_value # var_description
- `docker-compose.yml`: the following comments will be parsed:
  - #name template_and_stack_name
  - #category filter_cat_1 filter_cat_2
  - #brief short description visible in template list
  - #info html description of the stack including configuration and first run information
  - #logo url to image

Usage/Arguments:  
`-c`: output template json to console/stdout  
`-f [FILE ...]`: output template json to file, default `portainer-templates/templates.json`  

## Template Merger

- fork this repo
- from repository root execute: `python portainer-templates/tools/merge_template_urls.py [URL1 URL2 ...] -o output_json_filename`
- autogenerated file `portainer-templates/templates_merge.json` can be used directly in portainer
- publish templates and compose files
  - push changes to github and reference the repository
  - self host the files: `portainer-templates/tools/run_local_web_server.sh` # needs docker, follow cli instructions

#### merge_template_urls.py

Script will load raw JSON from specified URLs and merge the content into an output JSON template file.

Usage/Arguments:  
`[URL1 URL2 ...]`: string list of urls to template JSON files to merge  
`-o filename`: output template json to file, default: `portainer-templates/templates_merge.json`  
